<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>حاسبة حساب المواطن</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="calculators.css">
  <style>
    body {font-family: Tahoma; background: #0f172a; color: #f1f5f9; margin:0; padding:0;}
    .container {
      background:#1e293b; padding:30px; border-radius:20px; max-width:800px; margin:50px auto;
      box-shadow:0 0 30px rgba(34,197,94,0.4); border:2px solid #22c55e;
    }
    h2 {text-align:center; color:#22c55e; font-size:32px; margin-bottom:20px;}
    label {display:block; margin-top:15px; font-weight:bold; color:#86efac;}
    input, select {
      width:100%; padding:12px; margin-top:8px; border:1px solid #22c55e; border-radius:8px;
      background:#334155; color:#fff; font-size:16px; text-align:center;
    }
    button {
      width:100%; padding:14px; margin-top:25px; border:none; border-radius:10px;
      background:linear-gradient(45deg,#22c55e,#86efac); color:#000; font-size:18px; font-weight:bold;
      cursor:pointer; transition:0.3s;
    }
    button:hover {transform:scale(1.05); box-shadow:0 0 15px rgba(34,197,94,0.6);}
    .result {margin-top:25px; font-size:20px; color:#22c55e; text-align:center; font-weight:bold; white-space:pre-line;}
    .note {color:#9ccb6a; font-size:0.9em; margin-top:10px; text-align:center;}
    /* زر الرجوع ثابت */
    .back-btn {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding:8px 16px;
      font-size:14px;
      background:#6fae3f;
      color:#000;
      border-radius:6px;
      border:none;
      cursor:pointer;
      font-weight:bold;
      box-shadow:0 2px 6px rgba(0,0,0,0.4);
    }
    .back-btn:hover {
      background:#FFD700;
      color:#111;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>حاسبة حساب المواطن</h2>

    <label>نوع المستفيد:</label>
    <select id="beneficiary" onchange="toggleFields(); calculate();">
      <option value="head">رب أسرة</option>
      <option value="single">مستقل</option>
    </select>

    <div id="dependents">
      <label>عدد التابعين فوق 18 سنة:</label>
      <input type="number" id="above18" min="0" value="0" oninput="calculate()">

      <label>عدد التابعين تحت 18 سنة:</label>
      <input type="number" id="under18" min="0" value="0" oninput="calculate()">
    </div>

    <label id="incomeLabel">مجموع دخل الأسرة:</label>
    <input type="number" id="income" min="0" value="0" oninput="calculate()">

    <button id="calcBtn">احسب الدعم</button>
    <div class="result" id="result"></div>
    <div class="note">الحساب تقديري باستخدام القيم الرسمية (رب الأسرة 720، التابع فوق 18 = 360، التابع تحت 18 = 216).</div>
  </div>

  <!-- زر الرجوع ثابت -->
  <button class="back-btn" onclick="location.href='index.html'">⬅ الرجوع للصفحة الرئيسية</button>

  <script>
    function toggleFields() {
      const ben = document.getElementById("beneficiary").value;
      document.getElementById("dependents").style.display = (ben === "single") ? "none" : "block";
      document.getElementById("incomeLabel").innerText = (ben === "single") ? "مجموع الدخل:" : "مجموع دخل الأسرة:";
    }

    function calculate() {
      const beneficiary = document.getElementById("beneficiary").value;
      const above18 = parseInt(document.getElementById("above18").value) || 0;
      const under18 = parseInt(document.getElementById("under18").value) || 0;
      const income = parseFloat(document.getElementById("income").value) || 0;

      // الاستحقاق الكامل
      let full = 0;
      if (beneficiary === "single") {
        full = 720; // مستقل
      } else {
        full = 720 + (above18 * 360) + (under18 * 216);
      }

      // حدود التناقص والمنع (تقديرية حسب حجم الأسرة)
      const weight = 1 + above18 + under18;
      const exempt = weight * 1257;
      const cutoff = weight * 2091;

      let support = 0;
      if (income <= exempt) {
        support = full;
      } else if (income >= cutoff) {
        support = 0;
      } else {
        const ratio = (income - exempt) / (cutoff - exempt);
        support = full * (1 - ratio);
      }

      document.getElementById("result").innerText =
        "الدعم التقديري: " + Math.round(support).toLocaleString("ar-SA") + " ريال\n" +
        "حد التناقص: " + exempt.toLocaleString("ar-SA") + " ريال\n" +
        "الحد المانع: " + cutoff.toLocaleString("ar-SA") + " ريال";
    }

    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('calcBtn').addEventListener('click', calculate);
      toggleFields();
      calculate();
    });
  </script>
</body>
</html>
