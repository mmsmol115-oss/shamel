<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>شامل KSA</title>

  <!-- مكتبات التاريخ -->
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/min/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment-hijri@3.0.0/moment-hijri.min.js"></script>

  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>الصفحة الرئيسية</header>

  <!-- محول التاريخ -->
  <div class="converter-box">
    <h2>محول التاريخ</h2>
    <div class="converter-flex">
      <div class="converter-inputs">
        <label>أدخل التاريخ الميلادي:</label>
        <div class="row">
          <input type="text" class="input" id="gDay" placeholder="اليوم">
          <input type="text" class="input" id="gMonth" placeholder="الشهر">
          <input type="text" class="input" id="gYear" placeholder="السنة">
        </div>

        <label>أدخل التاريخ الهجري:</label>
        <div class="row">
          <input type="text" class="input" id="hDay" placeholder="اليوم">
          <input type="text" class="input" id="hMonth" placeholder="الشهر">
          <input type="text" class="input" id="hYear" placeholder="السنة">
        </div>

        <button class="btn" id="convertBtn">تحويل</button>
        <div id="conversionResult"></div>
      </div>

      <!-- خانة تاريخ اليوم -->
      <div class="today-box">
        <h3>تاريخ اليوم</h3>
        <div id="todayDate"></div>
      </div>
    </div>
  </div>

  <!-- العد التنازلي -->
  <div class="section-card">
    <h2>متبقي على :</h2>
    <div class="countdown-grid" id="countdownGrid"></div>
  </div>

  <!-- روابط الحاسبات -->
  <div class="section-card">
    <h2>الحاسبات</h2>
    <div class="grid">
      <a href="retirement.html" class="icon">حاسبة التقاعد</a>
      <a href="endservice.html" class="icon">حاسبة نهاية الخدمة</a>
      <a href="social.html" class="icon">حاسبة الضمان</a>
      <a href="citizen.html" class="icon">حاسبة حساب المواطن</a>
    </div>
  </div>

  <footer>ممدوح الرشيدي</footer>

  <!-- سكربت بعد العناصر -->
  <script>
    const todayBox = document.getElementById('todayDate');
    const countdownGrid = document.getElementById('countdownGrid');

    // عرض تاريخ اليوم
    const now = new Date();
    const weekday = new Intl.DateTimeFormat('ar-SA-u-ca-gregory',{weekday:'long'}).format(now);
    const gDate = new Intl.DateTimeFormat('ar-SA-u-ca-gregory',{year:'numeric',month:'long',day:'numeric'}).format(now);
    let hDate = 'غير متاح';
    try { hDate = moment(now).format('iYYYY/iM/iD'); } catch(e){}
    todayBox.innerHTML = `${weekday}<br>الميلادي: ${gDate}<br>الهجري: ${hDate}`;

    // أحداث العد التنازلي
    const events = [
      { name:'الراتب', day:27 },
      { name:'التقاعد', day:1 },
      { name:'الضمان المطور', day:1 },
      { name:'ساند', day:1 },
      { name:'حافز', day:5 },
      { name:'دعم ريف', day:10, highlight:true },
      { name:'الدعم الزراعي', day:1 },
      { name:'حساب المواطن', day:10 },
      { name:'الدعم العقاري', day:24 },
      { name:'التأهيل الشامل', day:26 },
      { name:'اليوم الوطني السعودي', fixedMonth:8, fixedDay:23, highlight:true },
      { name:'يوم التأسيس السعودي', fixedMonth:1, fixedDay:22, highlight:true }
    ];

    function nextTargetFrom(event, now){
      if (event.fixedMonth !== undefined) {
        let t = new Date(now.getFullYear(), event.fixedMonth, event.fixedDay);
        if (t < now) t = new Date(now.getFullYear()+1, event.fixedMonth, event.fixedDay);
        return t;
      } else {
        let t = new Date(now.getFullYear(), now.getMonth(), event.day);
        if (t < now) t = new Date(now.getFullYear(), now.getMonth()+1, event.day);
        return t;
      }
    }

    function updateCountdowns(){
      const now2 = new Date();
      const items = events.map(ev=>{
        const target = nextTargetFrom(ev, now2);
        const diffMs = target - now2;

        if (diffMs <= 0) {
          return { name:ev.name, highlight:ev.highlight, diff:0, text:'اليوم ✅' };
        }

        const hoursTotal = Math.floor(diffMs / (1000 * 60 * 60));
        let text;
        if (hoursTotal >= 24) {
          const days = Math.ceil(hoursTotal / 24);
          text = `متبقي ${days} يوم`;
        } else {
          text = `متبقي ${hoursTotal} ساعة`;
        }

        return { name:ev.name, highlight:ev.highlight, diff:diffMs, text:text };
      }).sort((a,b)=> a.diff - b.diff);

      countdownGrid.innerHTML = '';
      items.forEach(item=>{
        const card = document.createElement('div');
        card.className = 'countdown-card' + (item.text.includes('اليوم') ? ' done' : '');
        const nameHtml = `<strong class="${item.highlight ? 'hl' : ''}">${item.name}</strong>`;
        card.innerHTML = `${nameHtml}<br>${item.text}`;
        countdownGrid.appendChild(card);
      });
    }

    updateCountdowns();
    setInterval(updateCountdowns, 1000);
  </script>
</body>
</html>
