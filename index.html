<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>شامل KSA</title>

  <!-- ربط ملف التنسيقات الخارجي -->
  <link rel="stylesheet" href="style.css">

  <!-- مكتبات التاريخ -->
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/min/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment-hijri@3.0.0/moment-hijri.min.js"></script>
</head>

<body>
  <header>الصفحة الرئيسية</header>

  <!-- محول التاريخ -->
  <div class="converter-box">
    <h2>محول التاريخ</h2>
    <div class="converter-flex">
      <div class="converter-inputs">
        <label>أدخل التاريخ الميلادي:</label>
        <div class="row" id="gInputs">
          <input type="text" id="gDay" placeholder="اليوم" data-maxlen="2">
          <input type="text" id="gMonth" placeholder="الشهر" data-maxlen="2">
          <input type="text" id="gYear" placeholder="السنة" data-maxlen="4">
        </div>

        <label>أدخل التاريخ الهجري:</label>
        <div class="row" id="hInputs">
          <input type="text" id="hDay" placeholder="اليوم" data-maxlen="2">
          <input type="text" id="hMonth" placeholder="الشهر" data-maxlen="2">
          <input type="text" id="hYear" placeholder="السنة" data-maxlen="4">
        </div>

        <button class="btn" id="convertBtn">تحويل</button>
        <div id="conversionResult" style="margin-top:6px;"></div>
      </div>

      <div class="today-box">
        <h3>تاريخ اليوم</h3>
        <div id="todayDate"></div>
      </div>
    </div>
  </div>

  <!-- العد التنازلي -->
  <div class="section-card">
    <h2>متبقي على :</h2>
    <div class="countdown-grid" id="countdownGrid"></div>
  </div>

  <!-- روابط الحاسبات -->
  <div class="section-card">
    <h2>الحاسبات</h2>
    <div class="grid">
      <a href="retirement.html" class="icon">حاسبة التقاعد</a>
      <a href="endservice.html" class="icon">حاسبة نهاية الخدمة</a>
      <a href="social.html" class="icon">حاسبة الضمان</a>
      <a href="citizen.html" class="icon">حاسبة حساب المواطن</a>
    </div>
  </div>

  <footer>ممدوح الرشيدي</footer>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const todayBox = document.getElementById('todayDate');
      const countdownGrid = document.getElementById('countdownGrid');

      // عرض تاريخ اليوم
      const now = new Date();
      const gDate = now.toLocaleDateString('ar-SA', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
      let hDate = 'غير متاح';
      try {
        if (typeof moment !== 'undefined' && moment.fn && typeof moment.fn.iYear === 'function') {
          hDate = moment(now).format('iYYYY/iM/iD');
        }
      } catch(e) {}
      todayBox.innerHTML = `الميلادي: ${gDate}<br>الهجري: ${hDate}`;

      // أحداث العد التنازلي
      const events = [
        { name:'الراتب', day:27 },
        { name:'التقاعد', day:1 },
        { name:'الضمان المطور', day:1 },
        { name:'ساند', day:1 },
        { name:'حافز', day:5 },
        { name:'دعم ريف', day:10, highlight:true },
        { name:'الدعم الزراعي', day:1 },
        { name:'حساب المواطن', day:10 },
        { name:'الدعم العقاري', day:24 },
        { name:'التأهيل الشامل', day:26 },
        { name:'اليوم الوطني السعودي', fixedMonth:8, fixedDay:23, highlight:true },
        { name:'يوم التأسيس السعودي', fixedMonth:1, fixedDay:22, highlight:true }
      ];

      function nextTargetFrom(event, now){
        if (event.fixedMonth !== undefined) {
          let t = new Date(now.getFullYear(), event.fixedMonth, event.fixedDay);
          if (t < now) t = new Date(now.getFullYear()+1, event.fixedMonth, event.fixedDay);
          return t;
        } else {
          let t = new Date(now.getFullYear(), now.getMonth(), event.day);
          if (t < now) t = new Date(now.getFullYear(), now.getMonth()+1, event.day);
          return t;
        }
      }

      function updateCountdowns(){
        const now2 = new Date();
        const items = events.map(ev=>{
          const target = nextTargetFrom(ev, now2);
          const diff = target - now2;
          const days = Math.floor(diff / (1000 * 60 * 60 * 24));
          const hoursTotal = Math.floor(diff / (1000 * 60 * 60));
          let text;
          if (diff <= 0) text = 'اليوم ✅';
          else if (days >= 1) text = `متبقي ${days} يوم`;
          else text = `متبقي ${hoursTotal} ساعة`;
          return { name:ev.name, highlight:ev.highlight, diff, text };
        }).sort((a,b)=> a.diff - b.diff);

        countdownGrid.innerHTML = '';
        items.forEach(item=>{
          const card = document.createElement('div');
          card.className = 'countdown-card' + (item.text.includes('اليوم') ? ' done' : '');
          const nameHtml = `<strong class="${item.highlight ? 'hl' : ''}">${item.name}</strong>`;
          card.innerHTML = `${nameHtml}<br>${item.text}`;
          countdownGrid.appendChild(card);
        });
      }

      updateCountdowns();
      setInterval(updateCountdowns, 1000);
    });
  </script>
</body>
</html>
