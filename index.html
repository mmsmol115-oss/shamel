<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<link rel="stylesheet" href="style.css">
  <meta charset="UTF-8">
  <title>الصفحة الرئيسية</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- الترتيب الصحيح: moment ثم moment-hijri -->
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/min/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment-hijri@3.0.0/moment-hijri.min.js"></script>

  <style>
    :root { --bg:#000; --panel:#111; --text:#f1f5f9; --accent:#6fae3f; --alert:#b22222; --gold:#FFD700; }
    body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family:'Tahoma'; display:flex; flex-direction:column; min-height:100vh; }
    header { background:var(--panel); padding:15px; text-align:center; font-size:20px; font-weight:bold; color:var(--accent); }
    .card { background:var(--panel); margin:15px; padding:20px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.5); color:var(--accent); }
    h2 { margin-top:0; color:var(--gold); font-size:18px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:12px; margin:15px; }
    .done { color:var(--accent); font-weight:bold; }
    .highlight { color:var(--alert); font-weight:bold; }
    .row { display:flex; gap:10px; margin-bottom:10px; flex-wrap:wrap; }
.input {
  background:#222;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:6px;       /* تقليل الحشو الداخلي */
  font-size:14px;    /* تصغير حجم الخط */
  text-align:center;
  width:60px;        /* تصغير العرض */
}    .btn { background:var(--accent); color:#000; font-weight:bold; cursor:pointer; width:100%; margin-top:10px; padding:10px; border-radius:8px; border:none; font-size:16px; }
    .icon { background:var(--bg); border:2px solid var(--accent); border-radius:10px; padding:14px; text-align:center; color:var(--text); font-weight:bold; cursor:pointer; display:block; text-decoration:none; }
    .icon:hover { background:var(--accent); color:var(--bg); }
    footer { margin-top:auto; text-align:center; padding:10px; font-size:14px; color:var(--gold); }
    @media(max-width:600px){ .input{width:100px;} }
  </style>
</head>
<body>
  <header> الصفحة الرئيسية</header>

  <!-- محول التاريخ -->
  <div class="card">
    <h2>محول التاريخ</h2>
    <label>أدخل التاريخ الميلادي:</label>
    <div class="row" id="gInputs">
      <input type="text" id="gDay"   class="input" placeholder="اليوم"  inputmode="numeric" autocomplete="off" data-maxlen="2">
      <input type="text" id="gMonth" class="input" placeholder="الشهر"  inputmode="numeric" autocomplete="off" data-maxlen="2">
      <input type="text" id="gYear"  class="input" placeholder="السنة"  inputmode="numeric" autocomplete="off" data-maxlen="4">
    </div>

    <label>أدخل التاريخ الهجري:</label>
    <div class="row" id="hInputs">
      <input type="text" id="hDay"   class="input" placeholder="اليوم"  inputmode="numeric" autocomplete="off" data-maxlen="2">
      <input type="text" id="hMonth" class="input" placeholder="الشهر"  inputmode="numeric" autocomplete="off" data-maxlen="2">
      <input type="text" id="hYear"  class="input" placeholder="السنة"  inputmode="numeric" autocomplete="off" data-maxlen="4">
    </div>

    <button class="btn" id="convertBtn">تحويل</button>
    <div id="conversionResult" style="margin-top:10px;"></div>
  </div>

  <!-- العد التنازلي لمواعيد الصرف -->
  <div class="card">
    <h2>العد التنازلي لمواعيد الصرف</h2>
    <div class="grid" id="countdownGrid"></div>
  </div>

  <!-- روابط الحاسبات -->
  <div class="card">
    <h2>الحاسبات</h2>
    <div class="grid">
      <a href="retirement.html" class="icon">حاسبة التقاعد</a>
      <a href="endservice.html" class="icon">حاسبة نهاية الخدمة</a>
      <a href="social.html" class="icon">حاسبة الضمان</a>
      <a href="citizen.html" class="icon">حاسبة حساب المواطن</a>
    </div>
  </div>

  <footer>ممدوح الرشيدي</footer>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      // تأكيد توفر moment + hijri
      if (typeof moment === 'undefined' || !moment.fn.iYear) {
        document.getElementById('conversionResult').textContent = 'مكتبة التحويل غير محمّلة. تأكد من اتصال الإنترنت ووسوم المكتبات.';
        return;
      }

      // أدوات مساعدة
      function onlyDigits(s){ return String(s).replace(/\D+/g,''); }
      function pad2(n){ return String(n).padStart(2,'0'); }
      function isIntInRange(val, min, max){
        const s = String(val).trim();
        if(s === '' || !/^\d+$/.test(s)) return false;
        const n = Number(s);
        return Number.isInteger(n) && n >= min && n <= max;
      }
      function show(msg){ document.getElementById('conversionResult').textContent = msg; }

      // انتقال تلقائي بين الخانات
      function attachAutoAdvance(containerId){
        const inputs = Array.from(document.getElementById(containerId).querySelectorAll('input'));
        inputs.forEach((inp, idx)=>{
          inp.addEventListener('input', ()=>{
            inp.value = onlyDigits(inp.value);
            const maxlen = Number(inp.dataset.maxlen || 2);
            if(inp.value.length >= maxlen && idx + 1 < inputs.length){
              inputs[idx+1].focus();
              inputs[idx+1].select && inputs[idx+1].select();
            }
          });
        });
      }
      attachAutoAdvance('gInputs');
      attachAutoAdvance('hInputs');

      // محول التاريخ
      function convertDate(){
        try{
          const gD = document.getElementById("gDay").value;
          const gM = document.getElementById("gMonth").value;
          const gY = document.getElementById("gYear").value;

          const hD = document.getElementById("hDay").value;
          const hM = document.getElementById("hMonth").value;
          const hY = document.getElementById("hYear").value;

          // ميلادي -> هجري
          if(isIntInRange(gD,1,31) && isIntInRange(gM,1,12) && isIntInRange(gY,1,9999)){
            const gStr = `${gY}-${pad2(gM)}-${pad2(gD)}`;
            const mg = moment(gStr, "YYYY-MM-DD", true);
            if(!mg.isValid()){ show("تاريخ ميلادي غير صالح."); return; }
            show(`التاريخ الهجري: ${mg.format("iYYYY/iM/iD")}`);
            return;
          }

          // هجري -> ميلادي
          if(isIntInRange(hD,1,30) && isIntInRange(hM,1,12) && isIntInRange(hY,1,9999)){
            const mh = moment(`${Number(hY)}/${Number(hM)}/${Number(hD)}`, "iYYYY/iM/iD", true);
            if(!mh.isValid()){ show("تاريخ هجري غير صالح."); return; }
            show(`التاريخ الميلادي: ${mh.format("YYYY/MM/DD")}`);
            return;
          }

          show("أدخل اليوم ثم الشهر ثم السنة كاملة في إحدى الخانات.");
        }catch(e){
          show("حدث خطأ في التحويل. تأكد من الأرقام المدخلة.");
          console.error(e);
        }
      }
      document.getElementById('convertBtn').addEventListener('click', convertDate);

      // العدّ التنازلي
      const events = [
        { name: "الراتب", day: 27 },
        { name: "التقاعد", day: 1 },
        { name: "الضمان المطور", day: 10 },
        { name: "ساند", day: 10 },
        { name: "حافز", day: 5 },
        { name: "دعم ريف", day: 10, highlight: true },
        { name: "الدعم الزراعي", day: 1 },
        { name: "حساب المواطن", day: 10 },
        { name: "الدعم العقاري", day: 24 },
        { name: "التأهيل الشامل", day: 26 }
      ];

      function adjustWeekend(date){
        const day = date.getDay();
        if(day === 5) date.setDate(date.getDate() - 1); // جمعة -> خميس
        else if(day === 6) date.setDate(date.getDate() + 1); // سبت -> أحد
        return date;
      }

      function updateCountdowns(){
        try{
          const now = new Date();
          const grid = document.getElementById("countdownGrid");
          if(!grid) return;
          grid.innerHTML = "";

          const countdowns = events.map(event=>{
            let target = new Date(now.getFullYear(), now.getMonth(), event.day);
            if (target < now) target = new Date(now.getFullYear(), now.getMonth() + 1, event.day);
            target = adjustWeekend(target);

            const diff = target - now;
            const days = Math.floor(diff / (1000*60*60*24));
            const hours = Math.floor((diff / (1000*60*60)) % 24);
            const minutes = Math.floor((diff / (1000*60)) % 60);
            const seconds = Math.floor((diff / 1000) % 60);
            const text = diff <= 0 ? "تم الصرف ✅" : `متبقي ${days} يوم، ${hours} ساعة، ${minutes} دقيقة، ${seconds} ثانية`;

            return { name:event.name, highlight:event.highlight, time:diff, text };
          });

          countdowns.sort((a,b)=>a.time - b.time);

          countdowns.forEach(item=>{
            const card = document.createElement("div");
            card.className = "card";
            if(item.text.includes("تم الصرف")) card.classList.add("done");
            card.innerHTML = `<strong class="${item.highlight?'highlight':''}">${item.name}</strong><br>${item.text}`;
            grid.appendChild(card);
          });
        }catch(e){
          console.error('خطأ في العدّ التنازلي:', e);
        }
      }

      updateCountdowns();
      setInterval(updateCountdowns, 1000);
    });
  </script>
</body>

</html>

